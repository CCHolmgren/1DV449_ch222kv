function Message(a,b){this.getText=function(){return a},this.setText=function(){a=text},this.getDate=function(){return b},this.setDate=function(){b=b}}Message.prototype.toString=function(){return this.getText()+" ("+this.getDate()+")"},Message.prototype.getHTMLText=function(){return this.getText().replace(/[\n\r]/g,"<br />")},Message.prototype.getDateText=function(){return this.getDate().toLocaleTimeString()};var MessageBoard={messages:[],textField:null,messageArea:null,init:function(){MessageBoard.textField=$("#inputText"),MessageBoard.nameField=$("#inputName"),MessageBoard.messageArea=$("#messagearea"),document.getElementById("inputText").onfocus=function(){this.className="focus"},document.getElementById("inputText").onblur=function(){this.className="blur"},document.getElementById("buttonSend").onclick=function(){return MessageBoard.sendMessage(),!1},document.getElementById("buttonLogout").onclick=function(){return MessageBoard.logout(),!1},MessageBoard.textField.onkeypress=function(a){if(!a)var a=window.event;return 13!=a.keyCode||a.shiftKey?void 0:(MessageBoard.sendMessage(),!1)}},getMessages:function(){console.log("INNE"),$.ajax({type:"GET",url:"functions.php",data:{"function":"getMessages"}}).done(function(a){a=JSON.parse(a);for(var b in a){var c=a[b],d=c.name+" said:\n"+c.message,b=new Message(d,new Date),e=MessageBoard.messages.push(b)-1;MessageBoard.renderMessage(e)}document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length})},sendMessage:function(){""!=MessageBoard.textField.value&&$.ajax({type:"POST",url:"functions.php",data:"function=add&name="+MessageBoard.nameField.value+"&message="+MessageBoard.textField.value,success:function(){},error:function(a,b,c){alert("The message was not saved because of a "+c+" error."),console.log(a,b,c)}}).done(function(a){alert(a),$("#messagearea").prepend('<div class="message"><a href="#" class="clock">NaN<p>'+MessageBoard.nameField.value+" said:<br>"+MessageBoard.textField.value+"</p>"+"<span>13:41:01</span>"+'<span class="clear"></span>'+"</div>"),alert("Your message is saved! Reload the page for watching it")})},renderMessages:function(){MessageBoard.messageArea.innerHTML="";for(var a=0;a<MessageBoard.messages.length;++a)MessageBoard.renderMessage(a);document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length},renderMessage:function(a){var b=document.createElement("div");b.className="message",aTag=document.createElement("a"),aTag.href="#",aTag.classList.add("clock"),aTag.onclick=function(){return MessageBoard.showTime(a),!1},b.appendChild(aTag);var c=document.createElement("p");c.innerHTML=MessageBoard.messages[a].getHTMLText(),b.appendChild(c);var d=document.createElement("span");d.appendChild(document.createTextNode(MessageBoard.messages[a].getDateText())),b.appendChild(d);var e=document.createElement("span");e.className="clear",b.appendChild(e),MessageBoard.messageArea.prepend(b)},removeMessage:function(a){window.confirm("Vill du verkligen radera meddelandet?")&&(MessageBoard.messages.splice(a,1),MessageBoard.renderMessages())},showTime:function(a){var b=MessageBoard.messages[a].getDate(),c="Created "+b.toLocaleDateString()+" at "+b.toLocaleTimeString();alert(c)},logout:function(){window.location="index.php"}};window.onload=MessageBoard.init;
